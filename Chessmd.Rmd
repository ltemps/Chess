---
title: "First Impressions"
subtitle: "The Impact of Opening Move on a Chess Match"
author: "Lauren Temple"
date: "12/2021"
output: 
  pdf_document: default
---
TODO:
- Choose a color for EDA graphs, keep consistent color for those variables

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning=FALSE, message=FALSE)
pacman::p_load(readr, readxl, tidyverse, plyr, dplyr, lmerTest, gvlma, ggplot2, plotly, gridExtra, arm, lattice)
```

## Abstract

Chess is a strategy and tactic based board game played between two players. It is one of the world's most popular games and is played by millions of people worldwide. The opening move of a match is a topic that has books devoted to it and names for each particular movement pattern. In this report we examine the top five most frequently used opening moves in the data set as well as player Elo rating to predict the total number of moves in a match. After fitting a multilevel model I found that (insert conclusion statement).

## Introduction

In the game of chess, opening moves are thoughtfully chosen and often studied by avid players. The Elo rating system measures relative strength of an individual in a game compared to other players. The usage of this scored was officially adopted by the U.S. Chess Federation in 1960. Elo rating reflects the players results from previous rated games and calculated the probable outcome of a person's games against other players (Elo Rating System - Chess Terms). This report aims to use opening move choice as well as white player's Elo rating to predict the total number of moves in a chess match. Given that white makes the first move in chess, and thus initiates the opening moves, I chose to include white player Elo rating as a predictor in my analysis. I will begin with a discussion of my data cleaning and processing then move into key findings from my exploratory data analysis. I will then present my fitted model, results, and discuss how this model could be improved and utilized. 
## Methods

### Data Cleaning and Processing

The data set is published on [Kaggle: 15 Million Chess Games from Lichess (2013-2014)](https://www.kaggle.com/maca11/chess-games-from-lichess-20132014?select=Lichess_2013_2014_Complete.csv). This data set contains 14,918,230 observations, each representing a different chess match. I began by removing columns that were not of interest to my analysis. I kept only matches that ocurred in 2014 so that I had one full year of data. I then filtered the matches by time to only include those classified as bullet (<= 179s), this is the second fastest time classification. The fastest time control category is ultrabullet (<= 29s), however it does not occur in this data set. At this point in my data cleaning there existed over two thousand unique opening moves. I decided to simplify the opening move column entries by keeping only the first segment of its description. For example if the opening move entry was "Scandinavian Defense: Modern Variation, Gipslis Variation" that entry would simply be "Scandinavian Defense". After simplifying the opening move there still remained hundreds of unique moves. I created a table (insert figure number) to examine the frequency at which they occur and selected the top five for analysis. The cleaned data set contains 947,915 observations of 8 variables.

Definition of columns:

| Column Name     | Description |
| :--:            | :----- |
| WhiteElo        | Elo* of the player with white pieces|
| BlackElo        | Elo* of the player with black pieces |
| Winner          | Color of the winning pieces |
| Termination     | How the game ended, it can be: Normal, Time Forfeit, Abandon or Rules infraction |
| Year            | Year when the game was played |
| TimeControl     | Classification of the games based on the estimated duration of a game|
| Opening         | Opening Move Name|
| Number of Moves | Number of moves of the game|

*Elo is a rating system that measures the relative strength of a player
** Time Control is calculated as InitialTime+ 40*Increment and has 

### Exploratory Data Analysis

```{r, include= FALSE}
source("Data_Wrangling.R")
```

```{r echo=FALSE, fig.height=4, fig.width= 10,fig.cap="caption of visualization"}
tibble(top_five)
```
Figure 1 shows

```{r echo=FALSE, fig.height=4, fig.width= 10,fig.cap="caption of visualization"}
ggplot(Chess) + geom_col(aes(x= Opening, y= WhiteElo)) +
  labs(title= "Opening move & White Elo Ranking", 
       x= "Opening Move", y= "White Elo Rank") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```
Figure 2 shows

```{r, echo=FALSE, fig.height=4, fig.width= 10,fig.cap="caption of visualization"}
ggplot(Chess, aes(x= WhiteElo, y= Number_of_Moves)) +
  geom_point(aes(color= Opening), alpha = 0.3) +
  labs(title= "Modeling Number of Moves", 
       x= "White Elo Rating", y= "Number_of_Moves") +
  geom_smooth(aes(color= Opening), method = "lm", se=FALSE) + theme(legend.position="none")
```

### Model Fitting (whichever model works name it 'fit')

Goal: predict number of moves based on opening move and WhiteElo 
Response- Number_of_Moves
Fixed Effects- Opening
Random Effects- WhiteElo (Complete Pooling?), Opening:WhiteElo interaction (Complete Pooling?)

```{r, echo=FALSE}
fit <- lmer(Number_of_Moves ~ Opening + (1 | WhiteElo), Chess)
#fit <- lmer(Number_of_Moves ~ Opening + (1 | WhiteElo) + (1 | Opening:WhiteElo), Chess)

#summary(fit)
#coef(fit)
#confint(fit) #lower and upper bounds
```
Linear mixed model fit by REML. t-tests use Satterthwaite's method ['lmerModLmerTest']
Formula: Number_of_Moves ~ Opening + (1 | WhiteElo)
   Data: Chess

Fixed Effects

|                     |Estimate   |Std. Error  |df         |t value |Pr(>&#124;t&#124;) |
|:---:                |:---:      |:---:       |:---:      |:---:   |:---:              |
|(Intercept)          |32.32      |0.1322      |1,439      |244.425 | < 2e-16 ***       |
|King's Pawn Game     |-2.085     |0.05750     |834,500    |-36.250 | < 2e-16 ***       |
|Queen's Pawn Game    |-0.07868   |0.05143     |833,400    |-1.530  |0.126              |
|Scandinavian Defense |-0.2646    |0.04678     |833,300    |-5.656  |1.55e-08 ***       |
|Sicilian Defense     |0.2625     |0.04080     |833,400    |6.434   |1.25e-10 ***       |

All of the top five opening moves, except for the Queen's Pawn Game, are significant at alpha = 0.05 level.

Random Effects

|Groups               |Name       |Variance |Std.Dev. |
|:---:                |:---:      |:---:    |:---:    |
|WhiteElo             |(Intercept)|26.95    |5.191    |
|Residual             |           |200.27   |14.152   |

Number of obs: 835175, groups:  WhiteElo, 1962

## Results

## Model Coefficients

### Model Validation

```{r echo=FALSE, fig.height=2.5, fig.width=6, fig.cap="Figure X. Binned residual plot to assess the overall fit of the model"}
binnedplot(fitted(fit),resid(fit))
```
The binned residual plot shows that a majority of residuals are between 2 and -2. The residuals are not randomly distributed across expected values as shown by the unequal dispersion and slight curving on the tail ends of expected values.


```{r echo=FALSE, fig.height=2.5, fig.width=6, fig.cap="Figure X. Residual plot and Q-Q plot"}
re <- plot(fit)
qq <- qqmath(fit)
grid.arrange(re,qq,nrow=1)
```
From the Residual plot in Figure X we can see that the mean of residuals is greater than 0. 

From the Q-Q plot in Figure X, we can see that from -2 to 2 a majority dots are on the line, outside of that range the standardized residuals stray from normal. 

```{r echo=FALSE, fig.height=2, fig.width=4, fig.cap="Residuals vs Leverage."}
ggplot(data.frame(lev= hatvalues(fit),pearson= residuals(fit,type="pearson")),
      aes(x=lev,y=pearson)) +
    geom_point() +
    theme_bw()
```




## Discussion

issues with the model 

## Conclusion

summary of results

limitations

\newpage
## Citations

Elo Rating System - Chess Terms. (n.d.). Chess.Com. https://www.chess.com/terms/elo-rating-chess
Wikipedia contributors. (2021, December 2). Chess. Wikipedia. https://en.wikipedia.org/wiki/Chess

\newpage
## Appendix
### More EDA
```{r echo= FALSE, fig.cap= "Distribution plots for opening move, termination type, time control, White Elo rating, and number of moves"}
p1 <- ggplot(data = Chess) + 
  geom_bar(aes(x= Opening, y= ..count..)) +
  labs(title= "Distribution of Opening Moves", x= "Opening Moves", y= "Frequency") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

p2 <- ggplot(data = Chess) + 
  geom_bar(aes(x= Termination, y= ..count..)) +
  labs(title = "Distribution of Termination \n Category",x = "Termination Category", 
       y= "Frequency") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

p3 <- ggplot(data = Chess) + 
  geom_bar(aes(x= TimeControl, y= ..count..)) +
  labs(title = "Distribution of Time Control", x = "Time Control Category", y= "Frequency")

p4 <- ggplot(data = Chess) + 
  geom_bar(aes(x= Number_of_Moves, y= ..count..)) +
  labs(title = "Distribution of Number of Moves", x = "Number of Moves", y= "Frequency")

p5 <- ggplot(data = Chess) + 
  geom_bar(aes(x= WhiteElo, y= ..count..)) +
  labs(title = "Distribution of WhiteElo", x = "WhiteElo", y= "Frequency") + 
  ylim (0, 10000)

p1
p4
grid.arrange(p2, p3, ncol=2)
p5
```

\newpage
### Full Results
Random effects of model
```{r echo=FALSE}
ranef(fit)
```
Fixed effects of model
```{r echo=FALSE}
fixef(fit)
```
Coefficients of model
```{r echo=FALSE}
coef(fit)
```

